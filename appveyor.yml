version: 1.0.{build}
os: Windows Server 2012 R2
configuration:
- Release
platform: x64
shallow_clone: true
clone_folder: c:\reinforcement_learning\
cache: c:\tools\vcpkg\installed\
# need to install nuget packages before Visual Studio starts to make ANTLR targets available.
build_script:
# Temporary workaround: https://github.com/Microsoft/vcpkg/issues/4189#issuecomment-417462822
- rd /s /q C:\OpenSSL-v11-Win32
- rd /s /q C:\OpenSSL-v11-Win64
- vcpkg install cpprestsdk:x64-windows
- cd c:\reinforcement_learning
- git submodule update --init --recursive
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\cs\cs\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\cs\azure\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\cs\azure_worker\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\cs\setup_bundle\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\cs\unittest\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\python\windows27\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\python\windows35\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\vowpalwabbit\packages.config
- nuget install -o ext_libs\vowpal_wabbit\packages ext_libs\vowpal_wabbit\vowpalwabbit\packages.config
- nuget install rl.sln
- '"C:\Program Files (x86)\MSBuild\14.0\Bin\MSBuild.exe" "rl.sln" /m /verbosity:normal /p:Configuration=Release;Platform=x64'
test_script:
- ps: >-
    if($env:PLATFORM -eq "x64")

    {
       cd c:\reinforcement_learning
       .\x64\Release\unit_test.exe
    }
on_failure:
- ps: Get-ChildItem C:\Users\appveyor\AppData\Local\CrashDumps\\*.dmp | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }
